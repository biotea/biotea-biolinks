<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <script src="./javascripts/underscore-1.8.3-min.js"></script>
    <script src="./javascripts/jquery-2.1.4.min.js"></script>
    <script src="./javascripts/config4TREC.js"></script>
    <script src="./javascripts/BiolinksViewer.js"></script>
    <link rel="stylesheet" href="stylesheets/bioteaBiolinks.css">
    <!--style>
        div, span {
            padding: 2px;
        }
    </style-->

    <script>
        var start = function() {
            var app = require("biotea-vis-biolinks");

            var instance = new app({
                el: '#biolinks',
                content: TREConfig.content,
                topics: TREConfig.topics,
                articles: TREConfig.articles,
                paths: {ft: './pmc/', ta: './pubmed/', ta_ft: './pubmed/'},
                maxTerms: 25,
                noLambda: false
            });
/*
            var allGroups = [
                {grp:'ACTI', total:0, totalTF:0},
                {grp:'ANAT', total:0, totalTF:0},
                {grp:'CHEM', total:0, totalTF:0},
                {grp:'CONC', total:0, totalTF:0},
                {grp:'DEVI', total:0, totalTF:0},
                {grp:'DISO', total:0, totalTF:0},
                {grp:'DRUG', total:0, totalTF:0},
                {grp:'GENE', total:0, totalTF:0},
                {grp:'GEOG', total:0, totalTF:0},
                {grp:'GNPT', total:0, totalTF:0},
                {grp:'OBJC', total:0, totalTF:0},
                {grp:'OBSV', total:0, totalTF:0},
                {grp:'OCCU', total:0, totalTF:0},
                {grp:'ORGA', total:0, totalTF:0},
                {grp:'PEOP', total:0, totalTF:0},
                {grp:'PHEN', total:0, totalTF:0},
                {grp:'PHYS', total:0, totalTF:0},
                {grp:'PROC', total:0, totalTF:0},
                {grp:'SYMP', total:0, totalTF:0},
                {grp:'TAXA', total:0, totalTF:0},
            ];
            var ft = function(topics, index, limit, allArticles, path) {
                var topic = topics[index];
                var result = {
                    topic: topic.id,
                    total: 0,
                    groups: [
                        {grp:'ACTI', total:0, totalTF:0},
                        {grp:'ANAT', total:0, totalTF:0},
                        {grp:'CHEM', total:0, totalTF:0},
                        {grp:'CONC', total:0, totalTF:0},
                        {grp:'DEVI', total:0, totalTF:0},
                        {grp:'DISO', total:0, totalTF:0},
                        {grp:'DRUG', total:0, totalTF:0},
                        {grp:'GENE', total:0, totalTF:0},
                        {grp:'GEOG', total:0, totalTF:0},
                        {grp:'GNPT', total:0, totalTF:0},
                        {grp:'OBJC', total:0, totalTF:0},
                        {grp:'OBSV', total:0, totalTF:0},
                        {grp:'OCCU', total:0, totalTF:0},
                        {grp:'ORGA', total:0, totalTF:0},
                        {grp:'PEOP', total:0, totalTF:0},
                        {grp:'PHEN', total:0, totalTF:0},
                        {grp:'PHYS', total:0, totalTF:0},
                        {grp:'PROC', total:0, totalTF:0},
                        {grp:'SYMP', total:0, totalTF:0},
                        {grp:'TAXA', total:0, totalTF:0},
                    ]
                };
                var articles = _.filter(allArticles, function(article) {
                    return article.topic === topic.id;
                });
                result.total = articles.length;
                var loaders = [];
                _.each(articles, function(article) {
                    var loader = instance.parser.loadAnnotations(path, article.id);
                    loaders.push(loader);
                    loader.done(function(loadedData) {
                        var groupBy = _.groupBy(loadedData.data, function(annot) {
                            return annot.group;
                        });
                        _.each(result.groups, function(group) {
                            if (groupBy[group.grp]) {
                                group.total += groupBy[group.grp].length;
                                _.each(groupBy[group.grp], function(annot) {
                                    group.totalTF += annot.tf * annot.idf;
                                });
                            }
                        });
                    }).fail( function(e) {
                        console.log(e);
                    });
                });
                $.when.apply(null, loaders).done(function () {
                    console.log(JSON.stringify(result));
                    _.each(result.groups, function(group) {
                        var totalGroup = _.find(allGroups, function(datum) {return group.grp === datum.grp});
                        totalGroup.total += group.total;
                        totalGroup.totalTF += group.totalTF;
                    });
                    index++;
                    if (index < limit) {
                        ft(topics, index, limit, allArticles, path);
                    } else {
                        _.each(allGroups, function(group) {
                            console.log(group.grp + '\t' + group.total + '\t' + group.totalTF + '\t');
                        });
                        console.log('END');
                    }
                });
            };

            ft(TREConfig.topics.ft, 0, TREConfig.topics.ft.length, TREConfig.articles.ft, './pmc/');
*/
        }
    </script>

</head>
<body onload="start();">
    <div class="wrapper">
        <header>
            <h1>Biotea-Biolinks for TREC Genomic Track 2005</h1>
        </header>
        <section id="biolinks">

        </section>
    </div>
</body>
</html>